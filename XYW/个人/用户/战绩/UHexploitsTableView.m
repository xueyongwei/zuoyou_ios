//
//  UHexploitsTableView.m
//  ZuoYou
//
//  Created by xueyongwei on 16/10/18.
//  Copyright © 2016年 xueyongwei. All rights reserved.
//

#import "UHexploitsTableView.h"

@implementation UHexploitsTableView
-(void)prepareData
{
    
    NSString *urlStr = [NSString stringWithFormat:@"%@/versus/stat",HeadUrl];
    NSDictionary *param1 = @{@"mid":self.userID,@"type":@"mypk"};
    [XYWhttpManager XYWpost:urlStr parameters:param1 inView:nil sucess:^(id result) {
        if ([result objectForKey:@"total"]&&[result objectForKey:@"win"]) {
            NSNumber *total = [result objectForKey:@"total"];
            NSNumber *win = [result objectForKey:@"win"];
            if (total && win) {
                self.pk = @{@"total":total,@"win":win};
                [self.tableView reloadData];
            }
        }
    } failure:^(NSError *error) {
        CoreSVPCenterMsg(error.localizedDescription);
    }];
    NSDictionary *param2 = @{@"mid":self.userID,@"type":@"mysupport"};
    [XYWhttpManager XYWpost:urlStr parameters:param2 inView:nil sucess:^(id result) {
        NSNumber *total = [result objectForKey:@"total"];
        NSNumber *win = [result objectForKey:@"win"];
        if (total && win) {
            self.sp = @{@"total":total,@"win":win};
            [self.tableView reloadData];
        }
        
    } failure:^(NSError *error) {
        CoreSVPCenterMsg(error.localizedDescription);
    }];
    //    /social/topcountdown
    NSString *topUrl = [NSString stringWithFormat:@"%@/social/topcountdown",HeadUrl];
    NSDictionary *topparam = @{@"mid":self.userID};
    [XYWhttpManager XYWpost:topUrl parameters:topparam inView:nil sucess:^(id result) {
        self.countdownModel = [TopcountdownModel mj_objectWithKeyValues:result];
        [self.tableView reloadData];
    } failure:^(NSError *error) {
        CoreSVPCenterMsg(error.localizedDescription);
    }];
}

#pragma mark - Table view data source

- (NSInteger)numberOfSectionsInTableView:(UITableView *)tableView {
    return 1;
}

- (NSInteger)tableView:(UITableView *)tableView numberOfRowsInSection:(NSInteger)section {
    
    return 3;
}
- (UITableViewCell *)tableView:(UITableView *)tableView cellForRowAtIndexPath:(NSIndexPath *)indexPath {
    
    if (indexPath.row ==0) {
        ZJPKTableViewCell *cell = [tableView dequeueReusableCellWithIdentifier:@"ZJPKTableViewCell"];
        if (!cell) {
            cell = [[[NSBundle mainBundle]loadNibNamed:@"ZJPKTableViewCell" owner:self options:nil]lastObject];
            if (self.isMe) {
                cell.itmTitleLabel.text = @"我的PK";
            }else{
                cell.itmTitleLabel.text = @"Ta的PK";
            }
        }
        NSNumber *total = [self.pk objectForKey:@"total"]?[self.pk objectForKey:@"total"]:@0;
        NSNumber *win = [self.pk objectForKey:@"win"]?[self.pk objectForKey:@"win"]:@0;
        cell.totalLabel.text = [NSString stringWithFormat:@"%@场",total];
        cell.winLabel.text = [NSString stringWithFormat:@"%@场",win];
        cell.loseLabel.text = [NSString stringWithFormat:@"%d场",total.intValue-win.intValue ];
        NSInteger percent =(total.intValue==0)?(-1):(win.floatValue/total.floatValue +0.005)*100;
        cell.percent =  percent;
        YXTabItemBaseViewDelegateModel *model = [YXTabItemBaseViewDelegateModel new];
        model.idx = 0;model.number = percent;
        [self.delegate setTabNub:model];
        return cell;
    }else if (indexPath.row ==1){
        ZJSupotTableViewCell *cell = [tableView dequeueReusableCellWithIdentifier:@"ZJSupotTableViewCell"];
        if (!cell) {
            cell = [[[NSBundle mainBundle]loadNibNamed:@"ZJSupotTableViewCell" owner:self options:nil]lastObject];
            if (self.isMe) {
                cell.itmTitleLabel.text = @"我的支持";
            }else{
                cell.itmTitleLabel.text = @"Ta的支持";
            }
        }
        NSNumber *total = [self.sp objectForKey:@"total"]?[self.sp objectForKey:@"total"]:@0;
        NSNumber *win = [self.sp objectForKey:@"win"]?[self.sp objectForKey:@"win"]:@0;
        cell.totalLabel.text = [NSString stringWithFormat:@"%@场",total];
        cell.winLabel.text = [NSString stringWithFormat:@"%@场",win];
        cell.loseLabel.text = [NSString stringWithFormat:@"%d场",total.intValue-win.intValue ];
        NSInteger percent =(total.intValue==0)?(-1):(win.floatValue/total.floatValue +0.005)*100;
        cell.percent =  percent;
        
        return cell;
    }else{
        ZJHonerTableViewCell *cell = [tableView dequeueReusableCellWithIdentifier:@"ZJHonerTableViewCell"];
        if (!cell) {
            cell = [[[NSBundle mainBundle]loadNibNamed:@"ZJHonerTableViewCell" owner:self options:nil]lastObject];
        }
        cell.countdownModel = self.countdownModel;
        return cell;
    }
    
}
-(UIView *)tableView:(UITableView *)tableView viewForHeaderInSection:(NSInteger)section
{
    return [[UIView alloc]initWithFrame:CGRectMake(0, 0, 0, 0.1)];
}
-(CGFloat)tableView:(UITableView *)tableView heightForRowAtIndexPath:(NSIndexPath *)indexPath
{
    return indexPath.row==0?147:155;
//    if (indexPath.row <=1) {
//        return 155;
//    }else{
//        return 155;
//    }
}
-(CGFloat)tableView:(UITableView *)tableView heightForHeaderInSection:(NSInteger)section
{
    return 0.1;
}
-(void)tableView:(UITableView *)tableView didSelectRowAtIndexPath:(NSIndexPath *)indexPath
{
    [tableView deselectRowAtIndexPath:indexPath animated:YES];
}


/*
// Only override drawRect: if you perform custom drawing.
// An empty implementation adversely affects performance during animation.
- (void)drawRect:(CGRect)rect {
    // Drawing code
}
*/

@end
